IncludeScript("vs_library")
Chat("Invisible Bridges Loaded")
::SMain <- this;
VS.GetSoloPlayer();
SPlayer.goggles <- false

// Requirements:
//    vs_library
//    logic_eventlistener : player_say
//    logic_eventlistener : player_info
//    logic_eventlistener : player_connect
//    logic_eventlistener : bullet_impact

::OnGameEvent_bullet_impact <- function( data )
{
	if (SPlayer.goggles == false)
	{
	gogglesOn()
	}
	googlesOff()	
}

::OnGameEvent_player_say <- function( data )
{
	local msg = data.text

	if( msg.slice(0,1) != "!") return
	SMain.say_cmd( msg.slice(1).tolower() )
}

function say_cmd( str )
{
	local buffer = split(str, " ")
	local val, cmd = buffer[0]
	try( val = buffer[1] ) catch(e){}

	switch( cmd.tolower() )
	{
	
		case "see":
		case "goggles":
			gogglesOn()
			break			
		case "play":
		case "nogoggles":
			gogglesOff()
			break
		case "r":
		case "reset":
			resetPlayer()
			break			
		case "help":
			//help command()
			break
		default:
			Chat("Invalid command.")
	}
}

function resetPlayer()
{
	local pos = HPlayer.GetOrigin()
	pos.x = 0
	pos.y = 0
	pos.z = 0
	HPlayer.SetOrigin(pos)
}

function gogglesOn()
{
	Chat(" Goggles On")
	EntFire("bridge*", "Disable","" , 0, self)
	EntFire("visibridge*", "Enable","" , 0, self)
	SPlayer.goggles = true
}

function gogglesOff()
{
	Chat(" Goggles Off")
	EntFire("bridge*", "Enable","" , 0, self)
	EntFire("visibridge*", "Disable","" , 0, self)
	SPlayer.goggles = false
}
